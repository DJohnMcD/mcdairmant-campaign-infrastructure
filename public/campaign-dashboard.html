<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NY-24 Campaign Operations Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            line-height: 1.6;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .campaign-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .district-badge {
            background: rgba(255,255,255,0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.875rem;
            margin-left: 0.5rem;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .notification-icon {
            position: relative;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
        }
        
        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        .card-action {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            text-decoration: none;
            display: inline-block;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .metric-item {
            text-align: center;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1e40af;
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .priority-list {
            list-style: none;
        }
        
        .priority-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .priority-item:last-child {
            border-bottom: none;
        }
        
        .priority-text {
            flex: 1;
        }
        
        .priority-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .priority-high {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .priority-medium {
            background: #fef3c7;
            color: #d97706;
        }
        
        .priority-low {
            background: #f0fdf4;
            color: #16a34a;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .quick-action-btn {
            background: white;
            border: 2px solid #e5e7eb;
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            text-decoration: none;
            color: #374151;
        }
        
        .quick-action-btn:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            background: white;
        }
        
        .btn-sm {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
        }
        
        .voter-list {
            margin-top: 1rem;
        }
        
        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-weight: 500;
            color: #374151;
        }
        
        .voter-items {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .voter-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            background: white;
            margin-bottom: 0.5rem;
            border-radius: 6px;
        }
        
        .voter-info {
            flex: 1;
        }
        
        .voter-name {
            font-weight: 500;
            color: #111827;
        }
        
        .voter-details {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .support-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .support-strong {
            background: #dcfce7;
            color: #166534;
        }
        
        .support-lean {
            background: #fef3c7;
            color: #92400e;
        }
        
        .support-undecided {
            background: #f3f4f6;
            color: #374151;
        }
        
        .support-oppose {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .event-list {
            margin-top: 1rem;
        }
        
        .event-items {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .event-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            background: white;
            margin-bottom: 0.5rem;
            border-radius: 6px;
            border-left: 4px solid var(--primary-blue);
        }
        
        .event-info {
            flex: 1;
        }
        
        .event-title {
            font-weight: 600;
            color: #111827;
            margin-bottom: 0.25rem;
        }
        
        .event-details {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }
        
        .event-meta {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        .event-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: capitalize;
        }
        
        .status-planning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-confirmed {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-in_progress {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .status-completed {
            background: #f3f4f6;
            color: #374151;
        }
        
        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            background: white;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin-right: 0.5rem;
        }
        
        .agent-chat {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
        }
        
        .message-user {
            background: #3b82f6;
            color: white;
            margin-left: 2rem;
        }
        
        .message-agent {
            background: white;
            border: 1px solid #e5e7eb;
            margin-right: 2rem;
        }
        
        .chat-input {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .campaign-title {
                font-size: 1rem;
            }
            
            .main-container {
                padding: 0.5rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-card {
                padding: 1rem;
            }
            
            .metric-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 1rem;
            }
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-online {
            background: #10b981;
        }
        
        .status-warning {
            background: #f59e0b;
        }
        
        .status-offline {
            background: #ef4444;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div>
                <span class="campaign-title">McDairmant for Congress</span>
                <span class="district-badge">NY-24</span>
            </div>
            <div class="user-menu">
                <div class="notification-icon" onclick="showNotifications()">
                    üîî
                    <span class="notification-badge" id="notificationCount">3</span>
                </div>
                <a href="/logout" class="card-action">Logout</a>
            </div>
        </div>
    </div>

    <div class="main-container">
        <!-- Today's Priorities -->
        <div class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">üìã Today's Priorities</h2>
                <span id="currentDate"></span>
            </div>
            <ul class="priority-list" id="dailyPriorities">
                <li class="priority-item">
                    <span class="priority-text">Review 5 pending expense classifications</span>
                    <span class="priority-badge priority-high">HIGH</span>
                </li>
                <li class="priority-item">
                    <span class="priority-text">Deposit $247 in cash receipts</span>
                    <span class="priority-badge priority-medium">MEDIUM</span>
                </li>
                <li class="priority-item">
                    <span class="priority-text">Upload bank statement for reconciliation</span>
                    <span class="priority-badge priority-low">LOW</span>
                </li>
            </ul>
        </div>

        <div class="dashboard-grid">
            <!-- Campaign Metrics -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">üìä Campaign Metrics</h2>
                    <button class="card-action" onclick="refreshMetrics()">Refresh</button>
                </div>
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-value" id="totalDonors">0</div>
                        <div class="metric-label">Total Donors</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" id="totalRaised">$0</div>
                        <div class="metric-label">Total Raised</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" id="voterContacts">0</div>
                        <div class="metric-label">Voter Contacts</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" id="daysToElection">0</div>
                        <div class="metric-label">Days to Election</div>
                    </div>
                </div>
            </div>

            <!-- Financial Tracking -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">üí∞ Financial Tracking</h2>
                    <button class="card-action" onclick="showExpenseForm()">Add Expense</button>
                </div>
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-value" id="pendingExpenses">0</div>
                        <div class="metric-label">Pending Classification</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" id="cashReceipts">$0</div>
                        <div class="metric-label">Undeposited Cash</div>
                    </div>
                </div>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="showCashReceiptForm()">
                        üì±<br>Record Cash
                    </button>
                    <button class="quick-action-btn" onclick="showBankUpload()">
                        üìÑ<br>Upload Statement
                    </button>
                    <button class="quick-action-btn" onclick="runReconciliation()">
                        üîÑ<br>Auto Reconcile
                    </button>
                </div>
            </div>

            <!-- FEC Compliance -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">‚öñÔ∏è FEC Compliance</h2>
                    <button class="card-action" onclick="generateFECReport()">Generate Report</button>
                </div>
                <ul class="priority-list">
                    <li class="priority-item">
                        <span class="priority-text">
                            <span class="status-indicator status-online"></span>
                            All contributions within limits
                        </span>
                    </li>
                    <li class="priority-item">
                        <span class="priority-text">
                            <span class="status-indicator status-warning"></span>
                            3 donors approaching $200 threshold
                        </span>
                    </li>
                    <li class="priority-item">
                        <span class="priority-text">
                            <span class="status-indicator status-online"></span>
                            No compliance issues detected
                        </span>
                    </li>
                </ul>
            </div>

            <!-- Voter Management -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">üó≥Ô∏è Voter Management</h2>
                    <button class="card-action" onclick="toggleVoterForm()">Add Voter</button>
                </div>
                
                <div id="voterForm" class="form-container" style="display: none;">
                    <form id="addVoterForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="voterFirstName">First Name</label>
                                <input type="text" id="voterFirstName" name="first_name" required>
                            </div>
                            <div class="form-group">
                                <label for="voterLastName">Last Name</label>
                                <input type="text" id="voterLastName" name="last_name" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="voterEmail">Email</label>
                                <input type="email" id="voterEmail" name="email">
                            </div>
                            <div class="form-group">
                                <label for="voterPhone">Phone</label>
                                <input type="tel" id="voterPhone" name="phone">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="voterAddress">Address</label>
                            <input type="text" id="voterAddress" name="address">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="voterCity">City</label>
                                <input type="text" id="voterCity" name="city">
                            </div>
                            <div class="form-group">
                                <label for="voterCounty">County</label>
                                <select id="voterCounty" name="county">
                                    <option value="">Select County</option>
                                    <option value="Oswego">Oswego</option>
                                    <option value="Cayuga">Cayuga</option>
                                    <option value="Onondaga">Onondaga</option>
                                    <option value="Wayne">Wayne</option>
                                    <option value="Seneca">Seneca</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="voterZip">ZIP Code</label>
                                <input type="text" id="voterZip" name="zip">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="voterParty">Party Affiliation</label>
                                <select id="voterParty" name="party_affiliation">
                                    <option value="">Select Party</option>
                                    <option value="Democrat">Democrat</option>
                                    <option value="Republican">Republican</option>
                                    <option value="Independent">Independent</option>
                                    <option value="Conservative">Conservative</option>
                                    <option value="Working Families">Working Families</option>
                                    <option value="Green">Green</option>
                                    <option value="Libertarian">Libertarian</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="voterSupport">Support Level</label>
                                <select id="voterSupport" name="support_level">
                                    <option value="">Select Support</option>
                                    <option value="Strong Support">Strong Support</option>
                                    <option value="Lean Support">Lean Support</option>
                                    <option value="Undecided">Undecided</option>
                                    <option value="Lean Oppose">Lean Oppose</option>
                                    <option value="Strong Oppose">Strong Oppose</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="voterContact">Contact Method</label>
                                <select id="voterContact" name="contact_method">
                                    <option value="">Preferred Contact</option>
                                    <option value="Phone">Phone</option>
                                    <option value="Email">Email</option>
                                    <option value="Text">Text</option>
                                    <option value="Mail">Mail</option>
                                    <option value="Door">Door Knocking</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="voterNotes">Notes</label>
                            <textarea id="voterNotes" name="notes" rows="3" placeholder="Conversation notes, issues of interest, etc."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Add Voter</button>
                        <button type="button" class="btn btn-secondary" onclick="toggleVoterForm()">Cancel</button>
                    </form>
                </div>
                
                <div class="voter-list" id="voterList">
                    <div class="list-header">
                        <span>Recent Voter Contacts</span>
                        <button class="btn btn-sm" onclick="loadVoters()">Refresh</button>
                    </div>
                    <div id="voterItems" class="voter-items">
                        <!-- Voter items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Event Management -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">üìÖ Event Management</h2>
                    <button class="card-action" onclick="toggleEventForm()">Add Event</button>
                </div>
                
                <div id="eventForm" class="form-container" style="display: none;">
                    <form id="addEventForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="eventTitle">Event Title</label>
                                <input type="text" id="eventTitle" name="title" required>
                            </div>
                            <div class="form-group">
                                <label for="eventType">Event Type</label>
                                <select id="eventType" name="event_type" required>
                                    <option value="">Select Type</option>
                                    <option value="Rally">Rally</option>
                                    <option value="Town Hall">Town Hall</option>
                                    <option value="Fundraiser">Fundraiser</option>
                                    <option value="Volunteer Training">Volunteer Training</option>
                                    <option value="Canvassing">Canvassing</option>
                                    <option value="Meeting">Meeting</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="eventDescription">Description</label>
                            <textarea id="eventDescription" name="description" rows="2" placeholder="Event description and goals"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="eventLocation">Location Name</label>
                                <input type="text" id="eventLocation" name="location" placeholder="Venue or location name">
                            </div>
                            <div class="form-group">
                                <label for="eventCounty">County</label>
                                <select id="eventCounty" name="county">
                                    <option value="">Select County</option>
                                    <option value="Oswego">Oswego</option>
                                    <option value="Cayuga">Cayuga</option>
                                    <option value="Onondaga">Onondaga</option>
                                    <option value="Wayne">Wayne</option>
                                    <option value="Seneca">Seneca</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="eventAddress">Address</label>
                            <input type="text" id="eventAddress" name="address" placeholder="Full address with city and ZIP">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="eventDate">Date</label>
                                <input type="date" id="eventDate" name="event_date" required>
                            </div>
                            <div class="form-group">
                                <label for="eventStartTime">Start Time</label>
                                <input type="time" id="eventStartTime" name="start_time">
                            </div>
                            <div class="form-group">
                                <label for="eventEndTime">End Time</label>
                                <input type="time" id="eventEndTime" name="end_time">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expectedAttendance">Expected Attendance</label>
                                <input type="number" id="expectedAttendance" name="expected_attendance" min="0" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="eventBudget">Budget</label>
                                <input type="number" id="eventBudget" name="budget" min="0" step="0.01" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label for="requiredVolunteers">Volunteers Needed</label>
                                <input type="number" id="requiredVolunteers" name="required_volunteers" min="0" placeholder="0">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="volunteerCoordinator">Volunteer Coordinator</label>
                                <input type="text" id="volunteerCoordinator" name="volunteer_coordinator" placeholder="Coordinator name">
                            </div>
                            <div class="form-group">
                                <label for="eventStatus">Status</label>
                                <select id="eventStatus" name="status">
                                    <option value="planning">Planning</option>
                                    <option value="confirmed">Confirmed</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="setupRequirements">Setup Requirements</label>
                            <textarea id="setupRequirements" name="setup_requirements" rows="2" placeholder="Setup and preparation requirements"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="equipmentNeeded">Equipment Needed</label>
                            <textarea id="equipmentNeeded" name="equipment_needed" rows="2" placeholder="Sound system, tables, chairs, etc."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="eventNotes">Notes</label>
                            <textarea id="eventNotes" name="notes" rows="3" placeholder="Additional notes and considerations"></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Create Event</button>
                        <button type="button" class="btn btn-secondary" onclick="toggleEventForm()">Cancel</button>
                    </form>
                </div>
                
                <div class="event-list" id="eventList">
                    <div class="list-header">
                        <span>Upcoming Events</span>
                        <button class="btn btn-sm" onclick="loadEvents()">Refresh</button>
                    </div>
                    <div id="eventItems" class="event-items">
                        <!-- Event items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- AI Agents Quick Access -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">ü§ñ Campaign AI Agents</h2>
                </div>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="chatWithAgent('martin')">
                        üéØ<br>Martin<br><small>Strategy</small>
                    </button>
                    <button class="quick-action-btn" onclick="chatWithAgent('eggsy')">
                        üé®<br>Eggsy<br><small>Creative</small>
                    </button>
                    <button class="quick-action-btn" onclick="chatWithAgent('ethel')">
                        ‚öñÔ∏è<br>Ethel<br><small>Legal</small>
                    </button>
                    <button class="quick-action-btn" onclick="chatWithAgent('terri')">
                        üîí<br>Terri<br><small>Private</small>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Expense Form Modal -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <h3>Add New Expense</h3>
            <form id="expenseForm">
                <div class="form-group">
                    <label class="form-label">Vendor Name</label>
                    <input type="text" class="form-input" name="vendor_name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-input" name="description" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Amount ($)</label>
                    <input type="number" step="0.01" class="form-input" name="amount" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-input" name="expense_date" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Payment Method</label>
                    <select class="form-select" name="payment_method">
                        <option value="credit_card">Credit Card</option>
                        <option value="debit_card">Debit Card</option>
                        <option value="cash">Cash</option>
                        <option value="check">Check</option>
                        <option value="bank_transfer">Bank Transfer</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Add Expense</button>
                <button type="button" class="btn-secondary" onclick="closeModal('expenseModal')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Cash Receipt Form Modal -->
    <div id="cashReceiptModal" class="modal">
        <div class="modal-content">
            <h3>Record Cash Receipt</h3>
            <form id="cashReceiptForm">
                <div class="form-group">
                    <label class="form-label">Amount ($)</label>
                    <input type="number" step="0.01" class="form-input" name="amount" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Source</label>
                    <select class="form-select" name="source">
                        <option value="can_collection">Can Collection</option>
                        <option value="event_donation">Event Donation</option>
                        <option value="merchandise">Merchandise Sale</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-input" name="location" placeholder="Where was this collected?">
                </div>
                <div class="form-group">
                    <label class="form-label">Collector Name</label>
                    <input type="text" class="form-input" name="collector_name">
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-input" name="receipt_date" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <input type="text" class="form-input" name="notes" placeholder="Any additional details">
                </div>
                <button type="submit" class="btn-primary">Record Receipt</button>
                <button type="button" class="btn-secondary" onclick="closeModal('cashReceiptModal')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Agent Chat Modal -->
    <div id="agentChatModal" class="modal">
        <div class="modal-content">
            <h3 id="agentChatTitle">Chat with Agent</h3>
            <div class="agent-chat" id="agentChatHistory"></div>
            <div class="chat-input">
                <input type="text" class="form-input" id="agentMessageInput" placeholder="Type your message...">
                <button class="btn-primary" onclick="sendAgentMessage()">Send</button>
            </div>
            <button type="button" class="btn-secondary" onclick="closeModal('agentChatModal')" style="margin-top: 1rem;">Close</button>
        </div>
    </div>

    <script>
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            loadDashboardMetrics();
            loadPendingTasks();
            
            // Set today's date as default for forms
            const today = new Date().toISOString().split('T')[0];
            document.querySelector('input[name="expense_date"]').value = today;
            document.querySelector('input[name="receipt_date"]').value = today;
        });

        function updateCurrentDate() {
            const today = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = today.toLocaleDateString('en-US', options);
            
            // Calculate days to election (November 3, 2026)
            const electionDay = new Date('2026-11-03');
            const diffTime = electionDay - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            document.getElementById('daysToElection').textContent = diffDays;
        }

        async function loadDashboardMetrics() {
            try {
                // Load donor metrics
                const donorsResponse = await fetch('/api/campaign/donors');
                if (donorsResponse.ok) {
                    const donors = await donorsResponse.json();
                    
                    if (Array.isArray(donors)) {
                        document.getElementById('totalDonors').textContent = donors.length;
                        const totalRaised = donors.reduce((sum, donor) => sum + parseFloat(donor.contribution_amount || 0), 0);
                        document.getElementById('totalRaised').textContent = '$' + totalRaised.toLocaleString();
                    } else {
                        console.warn('Donors response is not an array:', donors);
                        document.getElementById('totalDonors').textContent = '0';
                        document.getElementById('totalRaised').textContent = '$0';
                    }
                } else {
                    console.error('Failed to load donors:', donorsResponse.status);
                    document.getElementById('totalDonors').textContent = '0';
                    document.getElementById('totalRaised').textContent = '$0';
                }

                // Load expense metrics
                const expensesResponse = await fetch('/api/expenses?classification=pending');
                if (expensesResponse.ok) {
                    const pendingExpenses = await expensesResponse.json();
                    if (Array.isArray(pendingExpenses)) {
                        document.getElementById('pendingExpenses').textContent = pendingExpenses.length;
                    } else {
                        document.getElementById('pendingExpenses').textContent = '0';
                    }
                } else {
                    document.getElementById('pendingExpenses').textContent = '0';
                }

                // Load cash receipts
                const receiptsResponse = await fetch('/api/receipts/cash?deposited=false');
                if (receiptsResponse.ok) {
                    const cashReceipts = await receiptsResponse.json();
                    if (Array.isArray(cashReceipts)) {
                        const undepositedCash = cashReceipts.reduce((sum, receipt) => sum + parseFloat(receipt.amount || 0), 0);
                        document.getElementById('cashReceipts').textContent = '$' + undepositedCash.toLocaleString();
                    } else {
                        document.getElementById('cashReceipts').textContent = '$0';
                    }
                } else {
                    document.getElementById('cashReceipts').textContent = '$0';
                }

            } catch (error) {
                console.error('Error loading dashboard metrics:', error);
                // Set default values on error
                document.getElementById('totalDonors').textContent = '0';
                document.getElementById('totalRaised').textContent = '$0';
                document.getElementById('pendingExpenses').textContent = '0';
                document.getElementById('cashReceipts').textContent = '$0';
            }
        }

        async function loadPendingTasks() {
            // This would load actual pending tasks from the API
            // For now, showing static examples
        }

        function showExpenseForm() {
            document.getElementById('expenseModal').style.display = 'block';
        }

        function showCashReceiptForm() {
            document.getElementById('cashReceiptModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        async function submitExpense(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const expenseData = Object.fromEntries(formData);

            try {
                const response = await fetch('/api/expenses', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(expenseData)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert('Expense added successfully! Classification: ' + result.classification.classification);
                    closeModal('expenseModal');
                    loadDashboardMetrics();
                    event.target.reset();
                } else {
                    alert('Error adding expense');
                }
            } catch (error) {
                console.error('Error submitting expense:', error);
                alert('Error adding expense');
            }
        }

        async function submitCashReceipt(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const receiptData = Object.fromEntries(formData);

            try {
                const response = await fetch('/api/receipts/cash', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(receiptData)
                });

                if (response.ok) {
                    alert('Cash receipt recorded successfully!');
                    closeModal('cashReceiptModal');
                    loadDashboardMetrics();
                    event.target.reset();
                } else {
                    alert('Error recording cash receipt');
                }
            } catch (error) {
                console.error('Error submitting cash receipt:', error);
                alert('Error recording cash receipt');
            }
        }

        function chatWithAgent(agentName) {
            document.getElementById('agentChatTitle').textContent = 'Chat with ' + agentName.charAt(0).toUpperCase() + agentName.slice(1);
            document.getElementById('agentChatHistory').innerHTML = '';
            document.getElementById('agentChatModal').style.display = 'block';
            document.getElementById('agentChatModal').dataset.agent = agentName;
        }

        async function sendAgentMessage() {
            const input = document.getElementById('agentMessageInput');
            const message = input.value.trim();
            if (!message) return;

            const agentName = document.getElementById('agentChatModal').dataset.agent;
            const chatHistory = document.getElementById('agentChatHistory');

            // Add user message
            chatHistory.innerHTML += `<div class="message message-user">${message}</div>`;
            input.value = '';

            try {
                const response = await fetch(`/api/agent/${agentName}/respond`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message })
                });

                if (response.ok) {
                    const result = await response.json();
                    chatHistory.innerHTML += `<div class="message message-agent">${result.response}</div>`;
                    chatHistory.scrollTop = chatHistory.scrollHeight;
                } else {
                    chatHistory.innerHTML += `<div class="message message-agent">Sorry, I'm having trouble responding right now.</div>`;
                }
            } catch (error) {
                console.error('Error sending message to agent:', error);
                chatHistory.innerHTML += `<div class="message message-agent">Sorry, I'm having trouble responding right now.</div>`;
            }
        }

        async function runReconciliation() {
            try {
                const response = await fetch('/api/reconciliation/auto-match', {
                    method: 'POST'
                });

                if (response.ok) {
                    const result = await response.json();
                    alert(`Reconciliation complete: ${result.matches_created} matches created`);
                    loadDashboardMetrics();
                } else {
                    alert('Error running reconciliation');
                }
            } catch (error) {
                console.error('Error running reconciliation:', error);
                alert('Error running reconciliation');
            }
        }

        async function generateFECReport() {
            try {
                const response = await fetch('/api/compliance/expense-report?format=csv');
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'fec_expense_report.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Error generating FEC report:', error);
                alert('Error generating FEC report');
            }
        }

        function refreshMetrics() {
            loadDashboardMetrics();
            alert('Metrics refreshed!');
        }

        function showNotifications() {
            alert('Notifications:\n- 3 new donations to process\n- Bank statement ready for upload\n- FEC quarterly report due in 15 days');
        }

        function showBankUpload() {
            // This would open a file upload dialog
            alert('Bank statement upload feature coming soon!');
        }

        // Form event listeners
        document.getElementById('expenseForm').addEventListener('submit', submitExpense);
        document.getElementById('cashReceiptForm').addEventListener('submit', submitCashReceipt);

        // Enter key support for agent chat
        document.getElementById('agentMessageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendAgentMessage();
            }
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Voter Management Functions
        function toggleVoterForm() {
            const form = document.getElementById('voterForm');
            const isVisible = form.style.display !== 'none';
            form.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                // Clear form when showing
                document.getElementById('addVoterForm').reset();
            }
        }

        async function addVoter(formData) {
            try {
                console.log('Adding voter with data:', formData);
                
                const response = await fetch('/api/campaign/voters', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);

                const result = await response.json();
                console.log('Response data:', result);
                
                if (response.ok) {
                    showAlert('Voter added successfully!', 'success');
                    document.getElementById('addVoterForm').reset();
                    toggleVoterForm();
                    loadVoters(); // Refresh the voter list
                } else {
                    console.error('Server error:', result);
                    showAlert(`Failed to add voter: ${result.error || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                console.error('Network/Parse error adding voter:', error);
                showAlert(`Failed to add voter: ${error.message}`, 'error');
            }
        }

        async function loadVoters() {
            try {
                console.log('Loading voters...');
                const response = await fetch('/api/campaign/voters');
                console.log('Voters response status:', response.status);
                
                const voters = await response.json();
                console.log('Voters data:', voters);
                
                const voterItems = document.getElementById('voterItems');
                if (voters.length === 0) {
                    voterItems.innerHTML = '<div style="text-align: center; padding: 2rem; color: #6b7280;">No voters added yet. Add your first voter contact!</div>';
                    document.getElementById('voterContacts').textContent = '0';
                    return;
                }
                
                voterItems.innerHTML = voters.slice(0, 10).map(voter => {
                    const supportClass = getSupportClass(voter.support_level);
                    return `
                        <div class="voter-item">
                            <div class="voter-info">
                                <div class="voter-name">${voter.first_name} ${voter.last_name}</div>
                                <div class="voter-details">
                                    ${voter.city ? voter.city + ', ' : ''}${voter.county || ''} | 
                                    ${voter.party_affiliation || 'No party'} | 
                                    ${voter.contact_method || 'No preference'}
                                </div>
                                ${voter.notes ? `<div class="voter-details">${voter.notes}</div>` : ''}
                            </div>
                            <div class="support-badge ${supportClass}">
                                ${voter.support_level || 'Unknown'}
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Update voter contacts metric
                document.getElementById('voterContacts').textContent = voters.length;
                console.log('Updated voter count to:', voters.length);
                
            } catch (error) {
                console.error('Error loading voters:', error);
                document.getElementById('voterItems').innerHTML = '<div style="text-align: center; padding: 2rem; color: #ef4444;">Failed to load voters</div>';
            }
        }

        function getSupportClass(supportLevel) {
            if (!supportLevel) return 'support-undecided';
            if (supportLevel.includes('Strong Support')) return 'support-strong';
            if (supportLevel.includes('Lean Support')) return 'support-lean';
            if (supportLevel.includes('Oppose')) return 'support-oppose';
            return 'support-undecided';
        }

        function showAlert(message, type = 'info') {
            // Create alert element
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 6px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                max-width: 400px;
                background: ${type === 'success' ? '#dcfce7' : type === 'error' ? '#fee2e2' : '#f3f4f6'};
                color: ${type === 'success' ? '#166534' : type === 'error' ? '#991b1b' : '#374151'};
                border: 1px solid ${type === 'success' ? '#bbf7d0' : type === 'error' ? '#fecaca' : '#d1d5db'};
            `;
            alert.textContent = message;
            
            document.body.appendChild(alert);
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 3000);
        }

        // Event Management Functions
        function toggleEventForm() {
            const form = document.getElementById('eventForm');
            const isVisible = form.style.display !== 'none';
            form.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                // Clear form and set default date
                document.getElementById('addEventForm').reset();
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('eventDate').value = today;
            }
        }

        async function addEvent(formData) {
            try {
                console.log('Adding event with data:', formData);
                
                const response = await fetch('/api/campaign/events', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                console.log('Event response status:', response.status);
                const result = await response.json();
                console.log('Event response data:', result);
                
                if (response.ok) {
                    showAlert('Event created successfully!', 'success');
                    document.getElementById('addEventForm').reset();
                    toggleEventForm();
                    loadEvents(); // Refresh the event list
                } else {
                    console.error('Server error:', result);
                    showAlert(`Failed to create event: ${result.error || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                console.error('Network/Parse error adding event:', error);
                showAlert(`Failed to create event: ${error.message}`, 'error');
            }
        }

        async function loadEvents() {
            try {
                console.log('Loading events...');
                const response = await fetch('/api/campaign/events');
                console.log('Events response status:', response.status);
                
                if (response.ok) {
                    const events = await response.json();
                    console.log('Events data:', events);
                    
                    const eventItems = document.getElementById('eventItems');
                    if (events.length === 0) {
                        eventItems.innerHTML = '<div style="text-align: center; padding: 2rem; color: #6b7280;">No events scheduled yet. Create your first campaign event!</div>';
                        return;
                    }
                    
                    eventItems.innerHTML = events.slice(0, 10).map(event => {
                        const statusClass = getEventStatusClass(event.status);
                        const eventDate = new Date(event.event_date).toLocaleDateString();
                        const timeRange = event.start_time && event.end_time ? 
                            `${event.start_time} - ${event.end_time}` : 
                            event.start_time || 'Time TBD';
                        
                        return `
                            <div class="event-item">
                                <div class="event-info">
                                    <div class="event-title">${event.title}</div>
                                    <div class="event-details">
                                        üìÖ ${eventDate} | ‚è∞ ${timeRange}
                                        ${event.location ? ` | üìç ${event.location}` : ''}
                                        ${event.county ? ` (${event.county} County)` : ''}
                                    </div>
                                    <div class="event-meta">
                                        ${event.event_type} | Expected: ${event.expected_attendance || 0} people
                                        ${event.required_volunteers ? ` | Volunteers needed: ${event.required_volunteers}` : ''}
                                    </div>
                                </div>
                                <div class="event-status ${statusClass}">
                                    ${event.status || 'planning'}
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    console.error('Failed to load events:', response.status);
                    document.getElementById('eventItems').innerHTML = '<div style="text-align: center; padding: 2rem; color: #ef4444;">Failed to load events</div>';
                }
                
            } catch (error) {
                console.error('Error loading events:', error);
                document.getElementById('eventItems').innerHTML = '<div style="text-align: center; padding: 2rem; color: #ef4444;">Failed to load events</div>';
            }
        }

        function getEventStatusClass(status) {
            if (!status) return 'status-planning';
            return `status-${status.toLowerCase().replace(' ', '_')}`;
        }

        // Form submission handlers
        document.getElementById('addVoterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const voterData = {};
            
            for (let [key, value] of formData.entries()) {
                voterData[key] = value;
            }
            
            addVoter(voterData);
        });

        document.getElementById('addEventForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const eventData = {};
            
            for (let [key, value] of formData.entries()) {
                eventData[key] = value;
            }
            
            addEvent(eventData);
        });

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadVoters();
            loadEvents();
        });
    </script>
</body>
</html>